{"version":3,"sources":["webpack:///./node_modules/@crc/stage/build/core/physics/debug_draw.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B;AACA;AACA,cAAc,gBAAgB,sCAAsC,iBAAiB,EAAE;AACvF,6BAA6B,8EAA8E;AAC3G;AACA;AACA;AACA;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA,CAAC;AACD,cAAc,SAAI,IAAI,SAAI;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,MAAM,gBAAgB;AACzC;AACA;AACA;AACA;AACA,iBAAiB,sBAAsB;AACvC;AACA;AACA;AACmD;AACS;AACX;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B,8DAAsB,4BAA4B,8DAAsB;AAClG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,8DAAsB,iBAAiB,8DAAsB;AACpF,2BAA2B,iBAAiB;AAC5C,2BAA2B,8DAAsB,iBAAiB,8DAAsB;AACxF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,8DAAsB,iBAAiB,8DAAsB;AACpF,2BAA2B,iBAAiB;AAC5C,2BAA2B,8DAAsB,iBAAiB,8DAAsB;AACxF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,8DAAsB,YAAY,8DAAsB,uBAAuB,0CAAE;AACrG;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB,8DAAsB;AAC3C,qBAAqB,8DAAsB;AAC3C;AACA,uCAAuC,0CAAE;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,WAAW;AAClC;AACA,2FAA2F,6CAAK;AAChG;AACA;AACA,2BAA2B,8DAAsB,YAAY,8DAAsB,YAAY,8DAAsB,aAAa,0CAAE;AACpI;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,4EAAwB;AAC5D;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB,aAAa;AACb;AACA,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,8DAAsB,QAAQ,8DAAsB;AAClF,8BAA8B,8DAAsB,QAAQ,8DAAsB;AAClF,8BAA8B,8DAAsB,QAAQ,8DAAsB;AAClF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB,8DAAsB,QAAQ,8DAAsB;AAC3E,uBAAuB,8DAAsB,QAAQ,8DAAsB;AAC3E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,8BAA8B,iEAAyB;AACvD;AACA;AACA;AACA;AACA,8BAA8B,mEAA2B;AACzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,8DAAsB,KAAK,8DAAsB;AACnF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,8DAAsB;AAC1C,oBAAoB,8DAAsB;AAC1C,oBAAoB,8DAAsB;AAC1C,oBAAoB,8DAAsB;AAC1C;AACA;AACA;AACA,uCAAuC,6CAAK;AAC5C,wCAAwC,4CAAI;AAC5C,4CAA4C,6CAAK;AACjD;AACA,CAAC,CAAC,4CAAI;AACe;AACrB,sC","file":"043f972cddbd2173576b.chunk.js","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nimport { Draw, Vec2, Color, pi } from '@crc/box2d';\nimport { PhysicsBodyTypes } from '../di/interfaces/physics';\nimport { convert_meter_to_pixel } from './utils';\nvar DebugDraw = /** @class */ (function (_super) {\n    __extends(DebugDraw, _super);\n    function DebugDraw(canvas) {\n        var _this = _super.call(this) || this;\n        _this.m_ctx = null;\n        _this.half_width = 310;\n        _this.half_height = 450;\n        _this.m_ctx = canvas.getContext('2d');\n        _this.half_width = canvas.width / 2;\n        _this.half_height = canvas.height / 2;\n        return _this;\n    }\n    DebugDraw.prototype.set_world = function (world) {\n        this.world = world;\n    };\n    DebugDraw.prototype.PushTransform = function (xf) {\n        var ctx = this.m_ctx;\n        if (ctx) {\n            ctx.save();\n            ctx.translate(convert_meter_to_pixel(xf.p.x) + this.half_width, convert_meter_to_pixel(xf.p.y) + this.half_height);\n            ctx.rotate(xf.q.GetAngle());\n        }\n    };\n    DebugDraw.prototype.PopTransform = function (xf) {\n        var ctx = this.m_ctx;\n        if (ctx) {\n            ctx.restore();\n        }\n    };\n    DebugDraw.prototype.DrawPolygon = function (vertices, vertexCount, color) {\n        var ctx = this.m_ctx;\n        if (ctx) {\n            ctx.beginPath();\n            ctx.moveTo(convert_meter_to_pixel(vertices[0].x), convert_meter_to_pixel(vertices[0].y));\n            for (var i = 1; i < vertexCount; i++) {\n                ctx.lineTo(convert_meter_to_pixel(vertices[i].x), convert_meter_to_pixel(vertices[i].y));\n            }\n            ctx.closePath();\n            ctx.strokeStyle = color.MakeStyleString(1);\n            ctx.stroke();\n        }\n    };\n    DebugDraw.prototype.DrawSolidPolygon = function (vertices, vertexCount, color) {\n        // 红色看不清，随手改改\n        if (color.r === 0.9) {\n            color.SetRGB(0.9, 0.9, 0.9);\n        }\n        var ctx = this.m_ctx;\n        if (ctx) {\n            ctx.beginPath();\n            ctx.moveTo(convert_meter_to_pixel(vertices[0].x), convert_meter_to_pixel(vertices[0].y));\n            for (var i = 1; i < vertexCount; i++) {\n                ctx.lineTo(convert_meter_to_pixel(vertices[i].x), convert_meter_to_pixel(vertices[i].y));\n            }\n            ctx.closePath();\n            ctx.fillStyle = color.MakeStyleString(0.1);\n            ctx.fill();\n            ctx.strokeStyle = color.MakeStyleString(1);\n            ctx.stroke();\n        }\n    };\n    DebugDraw.prototype.DrawCircle = function (center, radius, color) {\n        var ctx = this.m_ctx;\n        if (ctx) {\n            ctx.beginPath();\n            ctx.arc(convert_meter_to_pixel(center.x), convert_meter_to_pixel(center.y), radius, 0, pi * 2, true);\n            ctx.strokeStyle = color.MakeStyleString(1);\n            ctx.stroke();\n        }\n    };\n    DebugDraw.prototype.DrawSolidCircle = function (center, radius, axis, color) {\n        var ctx = this.m_ctx;\n        if (ctx) {\n            var cx = convert_meter_to_pixel(center.x);\n            var cy = convert_meter_to_pixel(center.y);\n            ctx.beginPath();\n            ctx.arc(cx, cy, radius, 0, pi * 2, true);\n            ctx.moveTo(cx, cy);\n            ctx.lineTo((cx + axis.x * radius), (cy + axis.y * radius));\n            ctx.fillStyle = color.MakeStyleString(0.5);\n            ctx.fill();\n            ctx.strokeStyle = color.MakeStyleString(1);\n            ctx.stroke();\n        }\n    };\n    // #if B2_ENABLE_PARTICLE\n    DebugDraw.prototype.DrawParticles = function (centers, radius, colors, count) {\n        if (!this.m_ctx)\n            return;\n        for (var i = 0; i < count; ++i) {\n            var center = centers[i];\n            var color = (colors === null || colors === void 0 ? void 0 : colors[i]) || new Color(255, 255, 255, 0.5);\n            this.m_ctx.fillStyle = color.MakeStyleString();\n            this.m_ctx.beginPath();\n            this.m_ctx.arc(convert_meter_to_pixel(center.x), convert_meter_to_pixel(center.y), convert_meter_to_pixel(radius), 0, pi * 2, true);\n            this.m_ctx.fill();\n        }\n    };\n    DebugDraw.prototype.DrawParticleTriads = function (centers, triangles) {\n        var _a;\n        if (!this.m_ctx)\n            return;\n        if ((_a = this.world) === null || _a === void 0 ? void 0 : _a.body_list) {\n            triangles = [];\n            this.world.body_list.forEach(function (b) {\n                var _a;\n                var p_body = b.get_current_physics_body();\n                if (p_body.type !== PhysicsBodyTypes.ELASTIC) {\n                    return;\n                }\n                var first_idx = p_body.particle_group.m_firstIndex;\n                (_a = p_body.soft_filter) === null || _a === void 0 ? void 0 : _a.triangle_top_points.forEach(function (t) {\n                    triangles.push([t[0] + first_idx, t[1] + first_idx, t[2] + first_idx]);\n                });\n            });\n        }\n        for (var i = 0; i < triangles.length; i++) {\n            var _b = __read(triangles[i], 3), a = _b[0], b = _b[1], c = _b[2];\n            var pa = centers[a];\n            var pb = centers[b];\n            var pc = centers[c];\n            if (!pa || !pb || !pc) {\n                console.error('Invalid triangle: ', triangles[i]);\n                continue;\n            }\n            this.m_ctx.fillStyle = 'rgba(0,0,0,0.5)';\n            this.m_ctx.beginPath();\n            this.m_ctx.moveTo(convert_meter_to_pixel(pa.x), convert_meter_to_pixel(pa.y));\n            this.m_ctx.lineTo(convert_meter_to_pixel(pb.x), convert_meter_to_pixel(pb.y));\n            this.m_ctx.lineTo(convert_meter_to_pixel(pc.x), convert_meter_to_pixel(pc.y));\n            this.m_ctx.closePath();\n            this.m_ctx.stroke();\n        }\n    };\n    // #endif\n    DebugDraw.prototype.DrawSegment = function (p1, p2, color) {\n        var ctx = this.m_ctx;\n        if (ctx) {\n            ctx.beginPath();\n            ctx.moveTo(convert_meter_to_pixel(p1.x), convert_meter_to_pixel(p1.y));\n            ctx.lineTo(convert_meter_to_pixel(p2.x), convert_meter_to_pixel(p2.y));\n            ctx.strokeStyle = color.MakeStyleString(1);\n            ctx.stroke();\n        }\n    };\n    DebugDraw.prototype.DrawTransform = function (xf) {\n        var ctx = this.m_ctx;\n        if (ctx) {\n            this.PushTransform(xf);\n            ctx.beginPath();\n            ctx.moveTo(0, 0);\n            ctx.lineTo(1, 0);\n            ctx.strokeStyle = Color.RED.MakeStyleString(1);\n            ctx.stroke();\n            ctx.beginPath();\n            ctx.moveTo(0, 0);\n            ctx.lineTo(0, 1);\n            ctx.strokeStyle = Color.GREEN.MakeStyleString(1);\n            ctx.stroke();\n            this.PopTransform(xf);\n        }\n    };\n    DebugDraw.prototype.DrawPoint = function (p, size, color) {\n        var ctx = this.m_ctx;\n        if (ctx) {\n            ctx.fillStyle = color.MakeStyleString();\n            var hsize = size / 2;\n            ctx.fillRect(p.x - hsize, p.y - hsize, size, size);\n        }\n    };\n    DebugDraw.prototype.DrawString = function (x, y, message) {\n        var ctx = this.m_ctx;\n        if (ctx) {\n            ctx.save();\n            ctx.setTransform(1, 0, 0, 1, 0, 0);\n            ctx.font = '15px DroidSans';\n            var color = DebugDraw.DrawString_s_color;\n            ctx.fillStyle = color.MakeStyleString();\n            ctx.fillText(message, convert_meter_to_pixel(x), convert_meter_to_pixel(y));\n            ctx.restore();\n        }\n    };\n    DebugDraw.prototype.DrawStringWorld = function (x, y, message) {\n        var ctx = this.m_ctx;\n        if (ctx) {\n            var p = DebugDraw.DrawStringWorld_s_p.Set(x, y);\n            ctx.save();\n            ctx.setTransform(1, 0, 0, 1, 0, 0);\n            ctx.font = '15px DroidSans';\n            var color = DebugDraw.DrawStringWorld_s_color;\n            ctx.fillStyle = color.MakeStyleString();\n            ctx.fillText(message, p.x, p.y);\n            ctx.restore();\n        }\n    };\n    DebugDraw.prototype.DrawAABB = function (aabb, color) {\n        var ctx = this.m_ctx;\n        if (ctx) {\n            ctx.strokeStyle = color.MakeStyleString();\n            var x = convert_meter_to_pixel(aabb.lowerBound.x);\n            var y = convert_meter_to_pixel(aabb.lowerBound.y);\n            var w = convert_meter_to_pixel(aabb.upperBound.x - aabb.lowerBound.x);\n            var h = convert_meter_to_pixel(aabb.upperBound.y - aabb.lowerBound.y);\n            ctx.strokeRect(x, y, w, h);\n        }\n    };\n    DebugDraw.DrawString_s_color = new Color(0.9, 0.6, 0.6);\n    DebugDraw.DrawStringWorld_s_p = new Vec2();\n    DebugDraw.DrawStringWorld_s_color = new Color(0.5, 0.9, 0.5);\n    return DebugDraw;\n}(Draw));\nexport { DebugDraw };\n//# sourceMappingURL=debug_draw.js.map"],"sourceRoot":""}